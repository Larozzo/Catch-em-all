import random
from time import sleep

# --- Pixel & Player Setup ---
# pixels.set_all_rgb(r, g, b)
# pixels.show()
# player.play_track(bank, track)
# player.volume = X

# Prozentwerte der Kisten
naechste = 10
mittlere = 20
weiteste = 30
kisten = [naechste, mittlere, weiteste]

# --- Funktionen ---

# Nach 3x Geworfen: kurzes grÃ¼nes Blinken + Sound
def hit(times=5, speed=0.3): 
    print("Gengar hit")
    player.volume = 20
    player.play_track(1, 4)  # Pokeball catching sound
    for i in range(times):
        pixels.set_all_rgb(0, 255, 0)   # GrÃ¼n an
        pixels.show()
        sleep(speed)
        pixels.set_all_rgb(0, 0, 0)     # Aus
        pixels.show()
        sleep(speed)

# 3 Sekunden Spannung vor Ergebnis
def waiting(times=3, speed=1):
    print("waiting for results")
    player.play_track(1, 6)  # Sound abspielen
    for i in range(times):
        pixels.set_all_rgb(255, 255, 255)  # WeiÃŸ an
        pixels.show()
        sleep(speed)
        pixels.set_all_rgb(0, 0, 0)        # Aus
        pixels.show()
        sleep(speed)

# Gewonnen â†’ PokÃ©mon gefangen
def catched():
    print("Gengar catched")
    player.play_track(1, 3)
    pixels.set_all_rgb(0, 255, 0)
    pixels.show()
    sleep(2)
    pixels.set_all_rgb(0, 0, 0)
    pixels.show()

def victory():
    print("You catched Gengar")
    player.play_track(1, 5)
    sleep(5)

# Verloren â†’ PokÃ©mon geflohen
def fled():     
    player.volume = 25
    player.play_track(1, 1)
    print("Gengar fled")
    pixels.set_all_rgb(255, 0, 0)
    pixels.show()
    sleep(2)
    pixels.set_all_rgb(0, 0, 0)
    pixels.show()

# --- Pixel-Blink pro Wurf ---
def blink_pixel(times=1, speed=0.3, color=(0,255,0)):
    for _ in range(times):
        pixels.set_all_rgb(*color)
        pixels.show()
        sleep(speed)
        pixels.set_all_rgb(0, 0, 0)
        pixels.show()
        sleep(speed)

# --- Spiel-Funktion ---
def spiel():
    gesamt = 0
    print("Starte Spiel...\n")

    # --- 3 WÃ¼rfe ---
    for w in range(1, 4):
        treffer = random.choice(kisten)
        gesamt += treffer
        print(f"Wurf {w}: {treffer}%")
        blink_pixel(times=1, speed=0.3)
        sleep(0.5)

    print("\nGesammelte Prozent:", gesamt, "%")

    # --- Hit Animation nach 3 WÃ¼rfen ---
    hit(times=5, speed=0.3)

    # --- 3 Sekunden Spannung ---
    waiting(times=3, speed=1)

    # --- Zufallsentscheidung ---
    zufall = random.randint(0, 100)
    print("Zufallswert:", zufall)

    if gesamt >= zufall:
        print("\nğŸ‰ GEWONNEN! ğŸ‰")
        catched()
        victory()
        return True, gesamt, zufall
    else:
        print("\nâŒ VERLOREN âŒ")
        fled()
        return False, gesamt, zufall

# --- Testlauf ---
if __name__ == "__main__":
    spiel()
